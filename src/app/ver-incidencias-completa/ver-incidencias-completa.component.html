<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title class="centered-title">Incidencias</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="incidencias-content">
  <ion-button shape="round" (click)="navigateToIncidencias()">Volver</ion-button>
  <ion-card *ngFor="let incidencia of incidencias" class="incidencia-card">
    <ion-card-header>
      <ion-card-title>Título: {{ incidencia.ct_titulo_incidencia }}</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="incidencia-details">
        <p><strong>Descripción:</strong> {{ incidencia.ct_descripcion_incidencia }}</p>
        <p><strong>Lugar:</strong> {{ incidencia.ct_lugar }}</p>
        <p><strong>Estado:</strong> {{ incidencia.ct_descripcion_estado}}</p>
        <p><strong>Usuario Registro:</strong> {{ incidencia.ct_nombre_completo }}</p>
        <div *ngIf="incidencia.cb_imagen">
          <p><strong>Imagen:</strong></p>
          <img [src]="'data:image/jpeg;base64,' + incidencia.cb_imagen" alt="Imagen de la incidencia" />
        </div>
      </div>
    </ion-card-content>
    <ion-button (click)="navigateToCreateDiagnosticos(incidencia.ct_id_incidencia)">Registrar Diagnóstico</ion-button>
  </ion-card>

  <ion-card>
    <ion-header>
      <ion-toolbar>
        <ion-title>Diagnósticos</ion-title>
      </ion-toolbar>
    </ion-header>
    <ion-card-content>
      <div *ngFor="let diagnostico of diagnosticos" class="diagnostico-card">
        <ion-item>
          <ion-label><strong>Fecha de diagnóstico:</strong></ion-label>
          <ion-text>{{ diagnostico.fecha_formateada }}</ion-text>
        </ion-item>
        <ion-item>
          <ion-label><strong>Diagnóstico:</strong></ion-label>
          <ion-text>{{ diagnostico.ct_diagnostico }}</ion-text>
        </ion-item>
        <ion-item>
          <ion-label><strong>Tiempo estimado de reparación:</strong></ion-label>
          <ion-text>{{ diagnostico.cn_tiempo_estimado_reparacion }}</ion-text>
        </ion-item>
        <ion-item>
          <ion-label><strong>Observaciones:</strong></ion-label>
          <ion-text>{{ diagnostico.ct_observaciones }}</ion-text>
        </ion-item>
        <div *ngIf="diagnostico.cb_imagen">
          <p><strong>Imagen:</strong></p>
          <img [src]="'data:image/jpeg;base64,' + diagnostico.cb_imagen" alt="Imagen del diagnóstico" />
        </div>
      </div>
    </ion-card-content>
  </ion-card>
  
</ion-content>
